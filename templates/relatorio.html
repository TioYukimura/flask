<!doctype html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8" />
        <title>Desempenho - Vale & Feira</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
            rel="stylesheet"
        />

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/relatorio.css') }}"
        />
    </head>

    <body>
        <header class="barra-topo">
            <a href="{{ url_for('main.home') }}" class="area-logo">
                <img
                    src="{{ url_for('static', filename='img/logo.png') }}"
                    alt="Vale&Feira"
                    class="logo-imagem"
                />
                <span class="logo-texto">Vale&Feira</span>
            </a>

            <nav class="links-topo">
                <a href="{{ url_for('main.home') }}">In√≠cio</a>
                <a href="{{ url_for('produto.buscar_produtos') }}">Produtos</a>

                {% if current_user.is_authenticated %}
                <a
                    href="{{ url_for('chat.meus_chats') }}"
                    class="link-conversas"
                >
                    Conversas {% if mensagens_nao_lidas is defined and
                    mensagens_nao_lidas > 0 %}
                    <span class="bolinha-notificacao"
                        >{{ mensagens_nao_lidas }}</span
                    >
                    {% endif %}
                </a>

                <nav class="link-planos">
                    <a href="{{ url_for('planos.lista_planos') }}"
                        >üåüPlanosüåü</a
                    >
                </nav>

                <a href="{{ url_for('perfil.perfil') }}">Perfil</a>
                <a href="{{ url_for('auth.logout') }}" class="link-sair"
                    >Sair</a
                >
                {% else %}
                <a href="{{ url_for('auth.login') }}" class="botao-login"
                    >Login</a
                >
                <a href="{{ url_for('auth.registrar') }}" class="botao-cadastro"
                    >Cadastrar</a
                >
                {% endif %}
            </nav>
        </header>

        <main class="container-relatorio">
            <div class="cabecalho-relatorio">
                <h1 class="titulo-relatorio">üìä Desempenho dos An√∫ncios</h1>
                <a href="{{ url_for('perfil.perfil') }}" class="botao-voltar">
                    ‚Üê Voltar ao Perfil
                </a>
            </div>

            <section class="grade-kpis">
                <div class="card-kpi">
                    <div class="kpi-legenda">üëÄ Visualiza√ß√µes Totais</div>
                    <div class="kpi-valor">{{ views }}</div>
                    <small class="kpi-ajuda"
                        >Pessoas que viram seus produtos</small
                    >
                </div>

                <div class="card-kpi">
                    <div class="kpi-legenda">üí¨ Contatos Iniciados</div>
                    <div class="kpi-valor">{{ contatos }}</div>
                    <small class="kpi-ajuda"
                        >Cliques no bot√£o ‚ÄúConversar‚Äù</small
                    >
                </div>

                <div class="card-kpi">
                    <div class="kpi-legenda">‚ö° Taxa de Interesse</div>
                    <div class="kpi-valor">{{ taxa }}%</div>
                    <small class="kpi-ajuda"
                        >Convers√£o de Visita em Contato</small
                    >
                </div>
            </section>

            <section class="caixa-grafico">
                <h3 class="titulo-secao">üìâ Quem v√™ vs. Quem chama</h3>
                <div class="area-canvas">
                    <canvas id="graficoFunil"></canvas>
                </div>
            </section>

            <section class="caixa-tabela">
                <h3 class="titulo-secao">üèÜ Seus Produtos</h3>

                {% if produtos %}
                <div class="tabela-responsiva">
                    <table class="tabela-produtos">
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Visualiza√ß√µes</th>
                                <th>Contatos</th>
                                <th>Pre√ßo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in produtos %}
                            <tr>
                                <td>{{ p.nome }}</td>
                                <td>{{ p.visualizacoes }}</td>
                                <td><strong>{{ p.contatos }}</strong></td>
                                <td>R$ {{ "%.2f"|format(p.preco) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="texto-vazio">
                    Voc√™ ainda n√£o tem produtos cadastrados ou visualizados.
                </p>
                {% endif %}
            </section>
        </main>

        <footer class="rodape">
            <div class="rodape-grade">
                <div class="rodape-coluna">
                    <h4>Vale&Feira</h4>
                    <p>
                        Conectando produtores e consumidores atrav√©s da
                        tecnologia e sustentabilidade.
                    </p>
                </div>

                <div class="rodape-coluna">
                    <h4>Links R√°pidos</h4>
                    <a href="{{ url_for('main.home') }}">In√≠cio</a>
                    <a href="{{ url_for('produto.buscar_produtos') }}"
                        >Produtos</a
                    >
                    <a href="{{ url_for('produto.adicionar_produtos') }}"
                        >Adicionar Produto</a
                    >
                    <a href="{{ url_for('chat.meus_chats') }}">Conversas</a>
                    {% if not current_user.is_authenticated %}
                    <a href="{{ url_for('auth.registrar') }}">Cadastrar</a>
                    {% endif %}
                </div>

                <div class="rodape-coluna">
                    <h4>Suporte</h4>
                    <a href="{{ url_for('main.relatar_bug_page') }}"
                        >Central de Ajuda</a
                    >
                    <a href="#" onclick="abrirModalTermos(); return false;"
                        >Termos de Uso</a
                    >
                </div>

                <div class="rodape-coluna">
                    <h4>Contatos</h4>
                    <a>üìßcontato@valefeira.com.br</a>
                    <a>üìßsuportevaleefeira@gmail.com</a>
                    <a href="#">üì± (38) 3333-4444</a>
                    <p>üìç Vale do Jequitinhonha, MG</p>
                </div>
            </div>

            <div class="rodape-final">
                &copy; 2026 Vale&Feira. Todos os direitos reservados.
            </div>
        </footer>

        <div id="modalTermos" class="modal-termos">
            <div class="modal-conteudo">
                <span class="botao-fechar-modal" onclick="fecharModalTermos()"
                    >&times;</span
                >
                <div class="modal-corpo">
                    <h3>Termos e Condi√ß√µes de Uso</h3>

                    <h4>1. Objeto e Defini√ß√£o</h4>
                    <p>
                        A plataforma Vale & Feira √© um ambiente digital
                        destinado √† divulga√ß√£o, promo√ß√£o e facilita√ß√£o da
                        comercializa√ß√£o de produtos cultivados e produzidos no
                        Vale do Jequitinhonha. O site atua como uma ‚Äúfeira
                        virtual‚Äù, conectando produtores locais (agricultores
                        familiares e artes√£os) a potenciais compradores.
                    </p>

                    <h4>2. Natureza do Servi√ßo (Intermedia√ß√£o de Contato)</h4>
                    <ul>
                        <li>
                            <strong>Divulga√ß√£o:</strong> A plataforma oferece
                            espa√ßo para que o produtor cadastre produtos com
                            fotos, descri√ß√£o e pre√ßo.
                        </li>
                        <li>
                            <strong>Aus√™ncia de Intermedi√°rios:</strong> O Vale
                            & Feira n√£o realiza a venda direta nem processa
                            pagamentos (nesta vers√£o MVP). A plataforma facilita
                            o contato via WhatsApp ou e-mail, sendo a transa√ß√£o
                            comercial de inteira responsabilidade das partes
                            envolvidas.
                        </li>
                    </ul>

                    <h4>3. Responsabilidades do Produtor (Vendedor)</h4>
                    <p>
                        Ao cadastrar um produto, o usu√°rio produtor garante que:
                    </p>
                    <ul>
                        <li>
                            As informa√ß√µes sobre o produto (origem, peso, tipo
                            de cultivo) s√£o verdadeiras.
                        </li>
                        <li>
                            As imagens postadas correspondem fielmente ao
                            produto ofertado.
                        </li>
                        <li>
                            Possui autoriza√ß√£o legal para comercializar os itens
                            listados.
                        </li>
                        <li>
                            Compromete-se a manter seus dados de contato
                            atualizados para viabilizar a negocia√ß√£o.
                        </li>
                    </ul>

                    <h4>4. Responsabilidades do Consumidor (Comprador)</h4>
                    <p>
                        O usu√°rio interessado em adquirir produtos reconhece
                        que:
                    </p>
                    <ul>
                        <li>
                            A plataforma n√£o garante a log√≠stica de entrega, que
                            deve ser combinada diretamente com o produtor.
                        </li>
                        <li>
                            A verifica√ß√£o da qualidade e proced√™ncia do produto
                            no ato da entrega √© de sua responsabilidade.
                        </li>
                    </ul>

                    <h4>5. Propriedade Intelectual e Identidade Regional</h4>
                    <p>
                        Todo o conte√∫do institucional, logotipos e a estrutura
                        do site s√£o de propriedade da Equipe de Desenvolvimento
                        Vale & Feira. A plataforma visa valorizar as tradi√ß√µes e
                        a identidade do Vale do Jequitinhonha; portanto, o uso
                        indevido da marca para fins que n√£o o apoio ao produtor
                        local √© proibido.
                    </p>

                    <h4>6. Limita√ß√£o de Responsabilidade</h4>
                    <p>A equipe Vale & Feira n√£o se responsabiliza por:</p>
                    <ul>
                        <li>
                            Negocia√ß√µes frustradas ou n√£o concretizadas entre
                            usu√°rios.
                        </li>
                        <li>
                            Diverg√™ncias de pre√ßos ou qualidade de produtos.
                        </li>
                        <li>
                            Eventuais problemas no transporte ou perecibilidade
                            de alimentos ap√≥s a sa√≠da da propriedade rural.
                        </li>
                    </ul>

                    <h4>7. Prote√ß√£o de Dados (LGPD)</h4>
                    <p>
                        Em conformidade com a Lei Geral de Prote√ß√£o de Dados, os
                        dados coletados (nome, e-mail, telefone e localiza√ß√£o)
                        ser√£o utilizados exclusivamente para:
                    </p>
                    <ul>
                        <li>
                            Cria√ß√£o do perfil de usu√°rio e autentica√ß√£o
                            (Flask-Login).
                        </li>
                        <li>
                            Exibi√ß√£o p√∫blica (no caso de produtores) para
                            viabilizar o contato comercial.
                        </li>
                        <li>
                            Seguran√ßa da plataforma contra acessos indevidos.
                        </li>
                    </ul>

                    <h4>8. Canal de √âtica e Den√∫ncias</h4>
                    <p>
                        Reservamo-nos o direito de remover an√∫ncios ou suspender
                        contas que apresentem comportamentos abusivos,
                        informa√ß√µes falsas ou que desrespeitem os princ√≠pios da
                        agricultura familiar e economia solid√°ria da regi√£o.
                    </p>

                    <div class="modal-acoes">
                        <button
                            type="button"
                            class="botao-fechar-termos"
                            onclick="fecharModalTermos()"
                        >
                            Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const contexto = document.getElementById("graficoFunil").getContext("2d");

            new Chart(contexto, {
                type: "bar",
                data: {
                    labels: {{ labels | tojson }},
                    datasets: [
                        {
                            label: "Visualiza√ß√µes",
                            data: {{ data_views | tojson }},
                            backgroundColor: "rgba(45, 90, 76, 0.5)",
                            borderColor: "#2d5a4c",
                            borderWidth: 1
                        },
                        {
                            label: "Contatos (Interesse)",
                            data: {{ data_contatos | tojson }},
                            backgroundColor: "#2d5a4c",
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            function abrirModalTermos() {
                document.getElementById("modalTermos").style.display = "flex";
            }

            function fecharModalTermos() {
                document.getElementById("modalTermos").style.display = "none";
            }

            window.onclick = function (event) {
                if (event.target == document.getElementById("modalTermos")) {
                    fecharModalTermos();
                }
            };
        </script>
    </body>
</html>
