<!doctype html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Chat com {{ outro_usuario.nome }} - Vale & Feira</title>

        <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
            rel="stylesheet"
        />

        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/chat.css') }}"
        />
    </head>

    <body>
        <header class="barra-topo">
            <a href="{{ url_for('main.home') }}" class="container-logo">
                <img
                    src="{{ url_for('static', filename='img/logo.png') }}"
                    class="imagem-logo"
                    alt="Logo"
                />
                <span class="texto-logo">Vale&Feira</span>
            </a>

            <nav class="links-navegacao">
                <a href="{{ url_for('main.home') }}">In√≠cio</a>
                <a href="{{ url_for('produto.buscar_produtos') }}">Produtos</a>

                <a href="{{ url_for('chat.meus_chats') }}">
                    Conversas {% if mensagens_nao_lidas is defined and
                    mensagens_nao_lidas > 0 %}
                    <span class="bolinha-notificacao"
                        >{{ mensagens_nao_lidas }}</span
                    >
                    {% endif %}
                </a>

                <nav class="link-planos">
                    <a href="{{ url_for('planos.lista_planos') }}"
                        >üåüPlanosüåü</a
                    >
                </nav>

                <a href="{{ url_for('perfil.perfil') }}">Perfil</a>
                <a href="{{ url_for('auth.logout') }}" class="link-sair"
                    >Sair</a
                >
            </nav>
        </header>

        <main class="area-chat">
            <div class="container-chat">
                <div class="cabecalho-chat">
                    <div class="info-cabecalho-chat">
                        <div class="avatar-usuario">
                            {% if outro_usuario.foto_perfil and
                            outro_usuario.foto_perfil != 'default_profile.png'
                            %}
                            <img
                                src="{{ url_for('static', filename='uploads/' + outro_usuario.foto_perfil) }}"
                                alt="Foto de {{ outro_usuario.nome }}"
                                loading="lazy"
                            />
                            {% else %}
                            <span class="icone-avatar">üë§</span>
                            {% endif %}
                        </div>

                        <div class="textos-cabecalho">
                            <h4>{{ outro_usuario.nome }}</h4>
                            <small>Conversando sobre: {{ produto.nome }}</small>
                        </div>
                    </div>

                    <a
                        href="{{ url_for('chat.meus_chats') }}"
                        class="botao-voltar"
                        >Voltar</a
                    >
                </div>

                <div class="area-mensagens" id="caixa-chat">
                    {% for chat_msg in chats %}
                    <div
                        class="mensagem {{ 'mensagem-enviada' if chat_msg.remetente_id == current_user.id else 'mensagem-recebida' }}"
                    >
                        {{ chat_msg.mensagem }}
                        <span class="horario"
                            >{{ chat_msg.data_criacao.strftime('%H:%M') }}</span
                        >
                    </div>
                    {% endfor %}
                </div>

                <div class="area-envio">
                    <form method="POST" class="form-envio">
                        {{ form.hidden_tag() }}
                        <input
                            type="text"
                            name="message"
                            placeholder="Digite sua mensagem..."
                            autocomplete="off"
                            required
                        />
                        <button type="submit" class="botao-enviar">‚ûî</button>
                    </form>
                </div>
            </div>
        </main>

        <footer class="rodape">
            <div class="grade-rodape">
                <div class="coluna-rodape">
                    <h4>Vale&Feira</h4>
                    <p>
                        Conectando produtores e consumidores atrav√©s da
                        tecnologia e sustentabilidade.
                    </p>
                </div>

                <div class="coluna-rodape">
                    <h4>Links R√°pidos</h4>
                    <a href="{{ url_for('main.home') }}">In√≠cio</a>
                    <a href="{{ url_for('produto.buscar_produtos') }}"
                        >Produtos</a
                    >
                    <a href="{{ url_for('produto.adicionar_produtos') }}"
                        >Adicionar Produto</a
                    >
                    <a href="{{ url_for('chat.meus_chats') }}">Conversas</a>
                    {% if not current_user.is_authenticated %}
                    <a href="{{ url_for('auth.registrar') }}">Cadastrar</a>
                    {% endif %}
                </div>

                <div class="coluna-rodape">
                    <h4>Suporte/Ajuda</h4>
                    <a href="{{ url_for('main.relatar_bug_page') }}"
                        >Central de Ajuda</a
                    >
                    <a href="#" onclick="abrirModalTermos(); return false;"
                        >Termos de Uso</a
                    >
                </div>

                <div class="coluna-rodape">
                    <h4>Contatos</h4>
                    <a>üìßcontato@valefeira.com.br</a>
                    <a>üìßsuportevaleefeira@gmail.com</a>
                    <a href="#">üì± (38) 3333-4444</a>
                    <p>üìç Vale do Jequitinhonha, MG</p>
                </div>
            </div>

            <div class="rodape-inferior">
                &copy; 2026 Vale&Feira. Todos os direitos reservados.
            </div>
        </footer>

        <div id="modalTermos" class="modal">
            <div class="conteudo-modal">
                <span class="botao-fechar-modal-x" onclick="fecharModalTermos()"
                    >&times;</span
                >

                <div class="corpo-modal">
                    <h3>Termos e Condi√ß√µes de Uso</h3>

                    <div class="area-modal">
                        <button
                            class="botao-fechar-modal"
                            onclick="fecharModalTermos()"
                        >
                            Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const caixaChat = document.getElementById("caixa-chat");
            if (caixaChat) caixaChat.scrollTop = caixaChat.scrollHeight;

            function abrirModalTermos() {
                document.getElementById("modalTermos").style.display = "flex";
            }
            function fecharModalTermos() {
                document.getElementById("modalTermos").style.display = "none";
            }
            window.onclick = function (event) {
                if (event.target == document.getElementById("modalTermos")) {
                    fecharModalTermos();
                }
            };
        </script>
    </body>
</html>
