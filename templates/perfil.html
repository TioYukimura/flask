<!doctype html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8" />
        <title>Perfil - Vale & Feira</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
            rel="stylesheet"
        />

        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/perfil.css') }}"
        />
    </head>
    <body>
        <header class="barra-topo">
            <a href="{{ url_for('main.home') }}" class="area-logo">
                <img
                    src="{{ url_for('static', filename='img/logo.png') }}"
                    alt="Vale&Feira"
                    class="imagem-logo"
                />
                <span class="texto-logo">Vale&Feira</span>
            </a>

            <nav class="links-navegacao">
                <a href="{{ url_for('main.home') }}">In√≠cio</a>
                <a href="{{ url_for('produto.buscar_produtos') }}">Produtos</a>

                {% if current_user.is_authenticated %}
                <a href="{{ url_for('chat.meus_chats') }}">
                    Conversas {% if mensagens_nao_lidas is defined and
                    mensagens_nao_lidas > 0 %}
                    <span class="bolinha-notificacao"
                        >{{ mensagens_nao_lidas }}</span
                    >
                    {% endif %}
                </a>

                <a
                    href="{{ url_for('planos.lista_planos') }}"
                    class="link-planos"
                    >üåüPlanosüåü</a
                >
                <a href="{{ url_for('perfil.perfil') }}">Perfil</a>
                <a href="{{ url_for('auth.logout') }}" class="link-sair"
                    >Sair</a
                >
                {% else %}
                <a href="{{ url_for('auth.login') }}" class="link-login"
                    >Login</a
                >
                <a href="{{ url_for('auth.registrar') }}" class="link-cadastro"
                    >Cadastrar</a
                >
                {% endif %}
            </nav>
        </header>

        <form
            id="form-upload-foto"
            action="{{ url_for('perfil.upload_foto') }}"
            method="POST"
            enctype="multipart/form-data"
            class="formulario-upload-foto"
        >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input
                type="file"
                name="foto"
                id="input-foto"
                accept="image/*"
                class="input-foto"
                onchange="document.getElementById('form-upload-foto').submit()"
            />
        </form>

        <main class="conteudo">
            {% with messages = get_flashed_messages(with_categories=true) %} {%
            if messages %} {% for category, message in messages %}
            <div class="mensagem-flash flash-{{ category }}">{{ message }}</div>
            {% endfor %} {% endif %} {% endwith %}

            <section class="card-perfil">
                <div class="caixa-plano">
                    {% set assinatura = current_user.assinatura_atual() %} {% if
                    assinatura %}
                    <span class="selo-plano selo-premium"
                        >‚≠ê {{ assinatura.plano.nome }}</span
                    >
                    <span class="texto-validade"
                        >Expira em: {{ assinatura.dias_restantes }} dias</span
                    >

                    {% if assinatura.plano.lista_beneficios %}
                    <ul class="lista-beneficios">
                        {% for beneficio in assinatura.plano.lista_beneficios %}
                        <li>{{ beneficio }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %} {% else %}
                    <span class="selo-plano selo-gratis">Sem plano</span>
                    {% endif %}
                </div>

                <div
                    class="avatar-perfil"
                    onclick="document.getElementById('input-foto').click()"
                    title="Clique para alterar a foto"
                    style="{% if current_user.foto_perfil and current_user.foto_perfil != 'default_profile.png' %}background-image: url('{{ url_for('static', filename='uploads/' + current_user.foto_perfil) }}');{% endif %}"
                >
                    {% if not current_user.foto_perfil or
                    current_user.foto_perfil == 'default_profile.png' %}
                    <span class="avatar-inicial"
                        >{{ current_user.nome[0]|upper }}</span
                    >
                    {% endif %}
                    <div class="avatar-acao">üì∑ Alterar</div>
                </div>

                <div class="info-perfil">
                    <h2 class="nome-usuario">{{ current_user.nome }}</h2>
                    <p class="linha-info">
                        Cliente desde {{ current_user.data_cadastro.strftime('%b
                        de %Y') }}
                    </p>
                    <p class="linha-info">üìß {{ current_user.email }}</p>
                    <p class="linha-info">
                        üìç {{ current_user.cidade or 'Cidade n√£o informada' }}
                    </p>
                </div>
            </section>

            <section class="grade-acoes">
                <div class="card-acao">
                    <h3 class="titulo-card">üë§ Meus Dados</h3>
                    <p class="texto-card">
                        Visualize e edite suas informa√ß√µes pessoais.
                    </p>
                    <a
                        href="{{ url_for('perfil.editar_perfil') }}"
                        class="botao-card"
                        >Editar Dados</a
                    >
                </div>

                {% set assinatura = current_user.assinatura_atual() %} {% if
                assinatura and ('produtor' in assinatura.plano.nome.lower() or
                'premium' in assinatura.plano.nome.lower()) %}
                <div class="card-acao card-destaque">
                    <h3 class="titulo-card">üìä Relat√≥rio</h3>
                    <p class="texto-card">
                        Acompanhe o desempenho dos seus an√∫ncios.
                    </p>
                    <a
                        href="{{ url_for('relatorio.dashboard') }}"
                        class="botao-card"
                        >Ver Painel</a
                    >
                </div>
                {% endif %}

                <div class="card-acao">
                    <h3 class="titulo-card">‚ûï Adicionar produto</h3>
                    <p class="texto-card">
                        Adicione seus produtos para venda na plataforma.
                    </p>
                    <a
                        href="{{ url_for('produto.adicionar_produtos') }}"
                        class="botao-card"
                        >Adicionar Produto</a
                    >
                </div>

                <div class="card-acao">
                    <h3 class="titulo-card">üí¨ Conversas</h3>
                    <p class="texto-card">
                        Acesse suas conversas com outros produtores.
                    </p>
                    <a
                        href="{{ url_for('chat.meus_chats') }}"
                        class="botao-card"
                        >Ver Conversas</a
                    >
                </div>

                <div class="card-acao">
                    <h3 class="titulo-card">‚≠ê Planos ‚≠ê</h3>
                    <p class="texto-card">
                        Gerencie sua assinatura e benef√≠cios.
                    </p>
                    <a
                        href="{{ url_for('planos.minha_assinatura') }}"
                        class="botao-card"
                        >Ver Assinatura</a
                    >
                </div>
            </section>

            <section class="secao-produtos">
                <div class="cabecalho-secao">
                    <h3 class="titulo-secao">Meus Produtos adicionados</h3>

                    {% set assinatura = current_user.assinatura_atual() %} {% if
                    assinatura %} {% set nome_plano =
                    assinatura.plano.nome.lower() %} {% set limite = 0 %} {% if
                    'b√°sico' in nome_plano or 'basico' in nome_plano %} {% set
                    limite = 5 %} {% elif 'produtor' in nome_plano %} {% set
                    limite = 20 %} {% elif 'premium' in nome_plano %} {% set
                    limite = 9999 %} {% endif %} {% set qtd_destaques = produtos
                    | selectattr('destaque', 'equalto', true) | list | length %}

                    <span
                        class="contador-destaques {{ 'contador-limite' if qtd_destaques >= limite and limite < 9999 else '' }}"
                    >
                        ‚≠ê Destaques: <strong>{{ qtd_destaques }}</strong> / {{
                        'Ilimitado' if limite > 1000 else limite }}
                    </span>
                    {% endif %}
                </div>

                {% if produtos %}
                <div class="grade-produtos">
                    {% for produto in produtos %}
                    <div class="card-produto">
                        {% if produto.destaque %}
                        <div class="selo-destaque" title="Produto em Destaque">
                            ‚≠ê
                        </div>
                        {% endif %}

                        <div class="conteudo-produto">
                            {% if produto.imagem %} {% if
                            produto.imagem.startswith('http') %} {% set
                            final_url = produto.imagem %} {% else %} {% set
                            final_url = url_for('static',
                            filename=produto.imagem) %} {% endif %} {% else %}
                            {% set final_url = url_for('static',
                            filename='img/sem_imagem.png') %} {% endif %}

                            <img
                                src="{{ final_url }}"
                                class="imagem-produto"
                                alt="Foto"
                                onerror="this.onerror=null; this.src='{{ url_for('static', filename='img/sem_imagem.png') }}';"
                            />

                            <div class="info-produto">
                                <h4 class="nome-produto">{{ produto.nome }}</h4>
                                <div class="preco-produto">
                                    R$ {{ "%.2f"|format(produto.preco) }}
                                </div>
                            </div>
                        </div>

                        <div class="acoes-produto">
                            <form
                                action="{{ url_for('produto.destacar_produto', id=produto.id) }}"
                                method="POST"
                                class="formulario-acao"
                            >
                                <input
                                    type="hidden"
                                    name="csrf_token"
                                    value="{{ csrf_token() }}"
                                />

                                {% if produto.destaque %}
                                <button
                                    type="submit"
                                    class="botao-remover-destaque"
                                >
                                    Remover Destaque
                                </button>
                                {% else %}
                                <button type="submit" class="botao-destacar">
                                    ‚≠ê Destacar
                                </button>
                                {% endif %}
                            </form>

                            <a
                                href="{{ url_for('produto.pagina_produto', id=produto.id) }}"
                                class="link-ver"
                                >Ver</a
                            >
                            <a
                                href="{{ url_for('produto.editar_produto', id=produto.id) }}"
                                class="link-editar"
                                >Editar</a
                            >

                            <form
                                action="{{ url_for('produto.excluir_produto', id=produto.id) }}"
                                method="POST"
                                class="formulario-acao"
                                onsubmit="return confirm('Tem certeza que deseja excluir?');"
                            >
                                <input
                                    type="hidden"
                                    name="csrf_token"
                                    value="{{ csrf_token() }}"
                                />
                                <button type="submit" class="botao-excluir">
                                    Excluir
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="estado-vazio">
                    <p class="estado-vazio-texto">
                        Voc√™ ainda n√£o cadastrou nenhum produto.
                    </p>
                </div>
                {% endif %}
            </section>
        </main>

        <footer class="rodape">
            <div class="grade-rodape">
                <div class="coluna-rodape">
                    <h4>Vale&Feira</h4>
                    <p>
                        Conectando produtores e consumidores atrav√©s da
                        tecnologia e sustentabilidade.
                    </p>
                </div>

                <div class="coluna-rodape">
                    <h4>Links R√°pidos</h4>
                    <a href="{{ url_for('main.home') }}">In√≠cio</a>
                    <a href="{{ url_for('produto.buscar_produtos') }}"
                        >Produtos</a
                    >
                    <a href="{{ url_for('produto.adicionar_produtos') }}"
                        >Adicionar Produto</a
                    >
                    <a href="{{ url_for('chat.meus_chats') }}">Conversas</a>
                    {% if not current_user.is_authenticated %}
                    <a href="{{ url_for('auth.registrar') }}">Cadastrar</a>
                    {% endif %}
                </div>

                <div class="coluna-rodape">
                    <h4>Suporte/Ajuda</h4>
                    <a href="#">Central de Ajuda</a>
                    <a href="#" onclick="abrirModalTermos(); return false;"
                        >Termos de Uso</a
                    >
                </div>

                <div class="coluna-rodape">
                    <h4>Contatos</h4>
                    <a>üìßcontato@valefeira.com.br </a>
                    <a>üìßsuportevaleefeira@gmail.com</a>
                    <a href="#">üì± (38) 3333-4444</a>
                    <p>üìç Vale do Jequitinhonha, MG</p>
                </div>
            </div>

            <div class="rodape-inferior">
                &copy; 2026 Vale&Feira. Todos os direitos reservados.
            </div>
        </footer>

        <div id="modalTermos" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="fecharModalTermos()"
                    >&times;</span
                >
                <div class="modal-body">
                    <h3>Termos e Condi√ß√µes de Uso</h3>

                    <h4>1. Objeto e Defini√ß√£o</h4>
                    <p>
                        A plataforma Vale & Feira √© um ambiente digital
                        destinado √† divulga√ß√£o, promo√ß√£o e facilita√ß√£o da
                        comercializa√ß√£o de produtos cultivados e produzidos no
                        Vale do Jequitinhonha. O site atua como uma "feira
                        virtual", conectando produtores locais (agricultores
                        familiares e artes√£os) a potenciais compradores.
                    </p>

                    <h4>2. Natureza do Servi√ßo (Intermedia√ß√£o de Contato)</h4>
                    <ul>
                        <li>
                            <strong>Divulga√ß√£o:</strong> A plataforma oferece
                            espa√ßo para que o produtor cadastre produtos com
                            fotos, descri√ß√£o e pre√ßo.
                        </li>
                        <li>
                            <strong>Aus√™ncia de Intermedi√°rios:</strong> O Vale
                            & Feira n√£o realiza a venda direta nem processa
                            pagamentos (nesta vers√£o MVP). A plataforma facilita
                            o contato via WhatsApp ou e-mail, sendo a transa√ß√£o
                            comercial de inteira responsabilidade das partes
                            envolvidas.
                        </li>
                    </ul>

                    <h4>3. Responsabilidades do Produtor (Vendedor)</h4>
                    <p>
                        Ao cadastrar um produto, o usu√°rio produtor garante que:
                    </p>
                    <ul>
                        <li>
                            As informa√ß√µes sobre o produto (origem, peso, tipo
                            de cultivo) s√£o verdadeiras.
                        </li>
                        <li>
                            As imagens postadas correspondem fielmente ao
                            produto ofertado.
                        </li>
                        <li>
                            Possui autoriza√ß√£o legal para comercializar os itens
                            listados.
                        </li>
                        <li>
                            Compromete-se a manter seus dados de contato
                            atualizados para viabilizar a negocia√ß√£o.
                        </li>
                    </ul>

                    <h4>4. Responsabilidades do Consumidor (Comprador)</h4>
                    <p>
                        O usu√°rio interessado em adquirir produtos reconhece
                        que:
                    </p>
                    <ul>
                        <li>
                            A plataforma n√£o garante a log√≠stica de entrega, que
                            deve ser combinada diretamente com o produtor.
                        </li>
                        <li>
                            A verifica√ß√£o da qualidade e proced√™ncia do produto
                            no ato da entrega √© de sua responsabilidade.
                        </li>
                    </ul>

                    <h4>5. Propriedade Intelectual e Identidade Regional</h4>
                    <p>
                        Todo o conte√∫do institucional, logotipos e a estrutura
                        do site s√£o de propriedade da Equipe de Desenvolvimento
                        Vale & Feira. A plataforma visa valorizar as tradi√ß√µes e
                        a identidade do Vale do Jequitinhonha; portanto, o uso
                        indevido da marca para fins que n√£o o apoio ao produtor
                        local √© proibido.
                    </p>

                    <h4>6. Limita√ß√£o de Responsabilidade</h4>
                    <p>A equipe Vale & Feira n√£o se responsabiliza por:</p>
                    <ul>
                        <li>
                            Negocia√ß√µes frustradas ou n√£o concretizadas entre
                            usu√°rios.
                        </li>
                        <li>
                            Diverg√™ncias de pre√ßos ou qualidade de produtos.
                        </li>
                        <li>
                            Eventuais problemas no transporte ou perecibilidade
                            de alimentos ap√≥s a sa√≠da da propriedade rural.
                        </li>
                    </ul>

                    <h4>7. Prote√ß√£o de Dados (LGPD)</h4>
                    <p>
                        Em conformidade com a Lei Geral de Prote√ß√£o de Dados, os
                        dados coletados (nome, e-mail, telefone e localiza√ß√£o)
                        ser√£o utilizados exclusivamente para:
                    </p>
                    <ul>
                        <li>
                            Cria√ß√£o do perfil de usu√°rio e autentica√ß√£o
                            (Flask-Login).
                        </li>
                        <li>
                            Exibi√ß√£o p√∫blica (no caso de produtores) para
                            viabilizar o contato comercial.
                        </li>
                        <li>
                            Seguran√ßa da plataforma contra acessos indevidos.
                        </li>
                    </ul>

                    <h4>8. Canal de √âtica e Den√∫ncias</h4>
                    <p>
                        Reservamo-nos o direito de remover an√∫ncios ou suspender
                        contas que apresentem comportamentos abusivos,
                        informa√ß√µes falsas ou que desrespeitem os princ√≠pios da
                        agricultura familiar e economia solid√°ria da regi√£o.
                    </p>

                    <div class="modal-actions">
                        <button
                            class="btn-modal-close"
                            onclick="fecharModalTermos()"
                        >
                            Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function abrirModalTermos() {
                document.getElementById("modalTermos").style.display = "flex";
            }
            function fecharModalTermos() {
                document.getElementById("modalTermos").style.display = "none";
            }
            window.onclick = function (event) {
                if (event.target == document.getElementById("modalTermos")) {
                    fecharModalTermos();
                }
            };
        </script>
    </body>
</html>
