<!doctype html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Vale & Feira</title>

        <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
            rel="stylesheet"
        />

        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/site.css') }}"
        />
    </head>

    <body>
        <header class="barra-topo">
            <a href="{{ url_for('main.home') }}" class="area-logo">
                <img
                    src="{{ url_for('static', filename='img/logo.png') }}"
                    alt="Vale&Feira"
                    class="logo-imagem"
                />
                <span class="logo-texto">Vale&Feira</span>
            </a>

            <div class="area-busca">
                <form
                    method="get"
                    action="{{ url_for('produto.buscar_produtos') }}"
                >
                    <input
                        type="text"
                        name="q"
                        class="input-busca"
                        placeholder="Buscar produto..."
                        value="{{ busca|default('') }}"
                    />
                    <button type="submit" class="botao-busca">Buscar</button>
                </form>
            </div>

            <nav class="links-topo">
                <a href="{{ url_for('main.home') }}">In√≠cio</a>
                <a href="{{ url_for('produto.buscar_produtos') }}">Produtos</a>

                {% if current_user.is_authenticated %}
                <a
                    href="{{ url_for('chat.meus_chats') }}"
                    class="link-conversas"
                >
                    Conversas {% if mensagens_nao_lidas is defined and
                    mensagens_nao_lidas > 0 %}
                    <span class="bolinha-notificacao"
                        >{{ mensagens_nao_lidas }}</span
                    >
                    {% endif %}
                </a>

                <nav class="link-planos">
                    <a href="{{ url_for('planos.lista_planos') }}"
                        >üåüPlanosüåü</a
                    >
                </nav>

                <a href="{{ url_for('perfil.perfil') }}">Perfil</a>
                <a href="{{ url_for('auth.logout') }}" class="link-sair"
                    >Sair</a
                >
                {% else %}
                <a href="{{ url_for('auth.login') }}" class="botao-login"
                    >Login</a
                >
                <a href="{{ url_for('auth.registrar') }}" class="botao-cadastro"
                    >Cadastrar</a
                >
                {% endif %}
            </nav>
        </header>

        <section class="hero">
            <h1>Conectando o Vale do Jequitinhonha</h1>
            <p>
                Produtos sustent√°veis direto do produtor para sua mesa, com
                tecnologia e responsabilidade ambiental
            </p>

            <div class="hero-botoes">
                <a
                    href="{{ url_for('produto.buscar_produtos') }}"
                    class="botao-principal"
                >
                    üõí Ver Produtos
                </a>
                <a
                    href="{{ url_for('produto.adicionar_produtos') }}"
                    class="botao-secundario"
                >
                    ‚ûï Adicionar Produto
                </a>
            </div>
        </section>

        <main class="container-principal">
            {% set produtos_destaque = [] %} {% set produtos_normais = [] %} {%
            if produtos %} {% for p in produtos %} {% if p.destaque %} {% set _
            = produtos_destaque.append(p) %} {% else %} {% set _ =
            produtos_normais.append(p) %} {% endif %} {% endfor %} {% endif %}
            {% if produtos_destaque %}
            <section class="secao-destaque">
                <h2 class="titulo-destaque">‚≠ê Produtos em Destaque ‚≠ê</h2>

                <div class="grade-produtos">
                    {% for produto in produtos_destaque %}
                    <div class="card-produto card-produto-destaque">
                        <div class="area-imagem-produto">
                            {% if produto.imagem %} {% if
                            produto.imagem.startswith('http') %} {% set
                            url_final = produto.imagem %} {% else %} {% set
                            url_final = url_for('static',
                            filename=produto.imagem) %} {% endif %} {% else %}
                            {% set url_final = url_for('static',
                            filename='img/sem_imagem.png') %} {% endif %}

                            <img
                                src="{{ url_final }}"
                                alt="{{ produto.nome }}"
                                onerror="this.onerror=null; this.src='{{ url_for('static', filename='img/sem_imagem.png') }}';"
                            />
                        </div>

                        <div class="area-badges-produto">
                            <span class="badge-categoria"
                                >{{ produto.categoria or 'Geral' }}</span
                            >

                            {% if produto.disponibilidade == 'sob_encomenda' %}
                            <span class="badge-disponibilidade badge-laranja"
                                >üì¶ Sob Encomenda</span
                            >
                            {% else %}
                            <span class="badge-disponibilidade badge-verde"
                                >‚úÖ Dispon√≠vel</span
                            >
                            {% endif %}
                        </div>

                        <h3 class="nome-produto">{{ produto.nome }}</h3>

                        <div class="info-produtor">
                            üë§ {{ produto.nome_produtor if produto.nome_produtor
                            else (produto.dono.nome if produto.dono else
                            'Produtor Local') }}
                        </div>

                        <div class="linha-preco">
                            {% if produto.desconto and produto.desconto > 0 %}
                            {% set preco_antigo = produto.preco / (1 -
                            (produto.desconto / 100)) %}
                            <span class="preco-antigo"
                                >R$ {{ "%.2f"|format(preco_antigo) }}</span
                            >

                            <span class="preco-novo">
                                R$ {{ "%.2f"|format(produto.preco) }}{% if
                                produto.unidade %} / {{ produto.unidade }}{%
                                endif %}
                            </span>

                            <span class="tag-desconto"
                                >-{{ produto.desconto }}%</span
                            >
                            {% else %}
                            <span class="preco-novo">
                                R$ {{ "%.2f"|format(produto.preco) }}{% if
                                produto.unidade %} / {{ produto.unidade }}{%
                                endif %}
                            </span>
                            {% endif %} {% if produto.media_notas > 0 %}
                            <span class="avaliacao-inline">
                                <span class="estrela">‚òÖ</span>
                                <span class="nota"
                                    >{{ produto.media_notas }}</span
                                >
                                <span class="quantidade"
                                    >({{ produto.total_avaliacoes }})</span
                                >
                            </span>
                            {% else %}
                            <span class="tag-novo">Novo</span>
                            {% endif %}
                        </div>

                        {% if current_user.is_authenticated %} {% if
                        current_user.id != produto.usuario_id %}
                        <a
                            href="{{ url_for('chat.chat', produto_id=produto.id, outro_usuario_id=produto.usuario_id) }}"
                            class="botao-conversar"
                        >
                            üí¨ Conversar com Produtor
                        </a>
                        {% else %}
                        <span class="botao-conversar desativado"
                            >Seu Produto</span
                        >
                        {% endif %} {% else %}
                        <a
                            href="{{ url_for('auth.login') }}"
                            class="botao-conversar"
                            >üîí Login</a
                        >
                        {% endif %}

                        <a
                            href="{{ url_for('produto.pagina_produto', id=produto.id) }}"
                            class="botao-detalhes"
                        >
                            Ver Detalhes
                        </a>

                        <a
                            href="{{ url_for('main.denunciar_produto_page', produto_id=produto.id) }}"
                            class="botao-denunciar"
                        >
                            ‚ö†Ô∏è Denunciar An√∫ncio
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <section class="secao-produtos">
                <div class="cabecalho-secao">
                    <h2>Produtos que Voc√™ Pode Gostar</h2>
                </div>

                <div class="grade-produtos">
                    {% if produtos_normais %} {% for produto in produtos_normais
                    %}
                    <div class="card-produto">
                        <div class="area-imagem-produto">
                            {% if produto.imagem %} {% if
                            produto.imagem.startswith('http') %} {% set
                            url_final = produto.imagem %} {% else %} {% set
                            url_final = url_for('static',
                            filename=produto.imagem) %} {% endif %} {% else %}
                            {% set url_final = url_for('static',
                            filename='img/sem_imagem.png') %} {% endif %}

                            <img
                                src="{{ url_final }}"
                                alt="{{ produto.nome }}"
                                onerror="this.onerror=null; this.src='{{ url_for('static', filename='img/sem_imagem.png') }}';"
                            />
                        </div>

                        <div class="area-badges-produto">
                            <span class="badge-categoria"
                                >{{ produto.categoria or 'Geral' }}</span
                            >

                            {% if produto.disponibilidade == 'sob_encomenda' %}
                            <span class="badge-disponibilidade badge-laranja"
                                >üì¶ Sob Encomenda</span
                            >
                            {% else %}
                            <span class="badge-disponibilidade badge-verde"
                                >‚úÖ Dispon√≠vel</span
                            >
                            {% endif %}
                        </div>

                        <h3 class="nome-produto">{{ produto.nome }}</h3>

                        <div class="info-produtor">
                            üë§ {{ produto.nome_produtor if produto.nome_produtor
                            else (produto.dono.nome if produto.dono else
                            'Produtor Local') }} {% if produto.cidade %} ‚Ä¢
                            Cidade: {{ produto.cidade }}{% endif %}
                        </div>

                        <div class="linha-preco">
                            {% if produto.desconto and produto.desconto > 0 %}
                            {% set preco_antigo = produto.preco / (1 -
                            (produto.desconto / 100)) %}
                            <span class="preco-antigo"
                                >R$ {{ "%.2f"|format(preco_antigo) }}</span
                            >

                            <span class="preco-novo">
                                R$ {{ "%.2f"|format(produto.preco) }}{% if
                                produto.unidade %} / {{ produto.unidade }}{%
                                endif %}
                            </span>

                            <span class="tag-desconto"
                                >-{{ produto.desconto }}%</span
                            >
                            {% else %}
                            <span class="preco-novo">
                                R$ {{ "%.2f"|format(produto.preco) }}{% if
                                produto.unidade %} / {{ produto.unidade }}{%
                                endif %}
                            </span>
                            {% endif %} {% if produto.media_notas > 0 %}
                            <span class="avaliacao-inline">
                                <span class="estrela">‚òÖ</span>
                                <span class="nota"
                                    >{{ produto.media_notas }}</span
                                >
                                <span class="quantidade"
                                    >({{ produto.total_avaliacoes }})</span
                                >
                            </span>
                            {% else %}
                            <span class="tag-novo">Novo</span>
                            {% endif %}
                        </div>

                        {% if current_user.is_authenticated %} {% if
                        current_user.id != produto.usuario_id %}
                        <a
                            href="{{ url_for('chat.chat', produto_id=produto.id, outro_usuario_id=produto.usuario_id) }}"
                            class="botao-conversar"
                        >
                            üí¨ Conversar com o Produtor
                        </a>
                        {% else %}
                        <span class="botao-conversar desativado"
                            >Seu Produto</span
                        >
                        {% endif %} {% else %}
                        <a
                            href="{{ url_for('auth.login') }}"
                            class="botao-conversar"
                            >üîí Login</a
                        >
                        {% endif %}

                        <a
                            href="{{ url_for('produto.pagina_produto', id=produto.id) }}"
                            class="botao-detalhes"
                        >
                            Ver Detalhes
                        </a>

                        <a
                            href="{{ url_for('main.denunciar_produto_page', produto_id=produto.id) }}"
                            class="botao-denunciar"
                        >
                            ‚ö†Ô∏è Denunciar An√∫ncio
                        </a>
                    </div>
                    {% endfor %} {% else %}
                    <p class="texto-sem-produtos">
                        Nenhum produto cadastrado no momento.
                    </p>
                    {% endif %}
                </div>
            </section>
        </main>

        <section class="secao-porque">
            <h2>Por que escolher o Vale&Feira?</h2>

            <div class="grade-porque">
                <div class="card-porque">
                    <div class="icone-porque">üå±</div>
                    <h3>100% Sustent√°vel</h3>
                    <p>
                        Produtos org√¢nicos e pr√°ticas ambientalmente
                        respons√°veis.
                    </p>
                </div>

                <div class="card-porque">
                    <div class="icone-porque">ü§ù</div>
                    <h3>Direto do Produtor</h3>
                    <p>Conectamos voc√™ diretamente aos produtores locais.</p>
                </div>

                <div class="card-porque">
                    <div class="icone-porque">üì±</div>
                    <h3>Tecnologia Rural</h3>
                    <p>Inova√ß√£o a servi√ßo da agricultura familiar.</p>
                </div>
            </div>
        </section>

        <footer class="rodape">
            <div class="rodape-grade">
                <div class="rodape-coluna">
                    <h4>Vale&Feira</h4>
                    <p>
                        Conectando produtores e consumidores atrav√©s da
                        tecnologia e sustentabilidade.
                    </p>
                </div>

                <div class="rodape-coluna">
                    <h4>Links R√°pidos</h4>
                    <a href="{{ url_for('main.home') }}">In√≠cio</a>
                    <a href="{{ url_for('produto.buscar_produtos') }}"
                        >Produtos</a
                    >
                    <a href="{{ url_for('produto.adicionar_produtos') }}"
                        >Adicionar Produto</a
                    >
                    <a href="{{ url_for('chat.meus_chats') }}">Conversas</a>
                    {% if not current_user.is_authenticated %}
                    <a href="{{ url_for('auth.registrar') }}">Cadastrar</a>
                    {% endif %}
                </div>

                <div class="rodape-coluna">
                    <h4>Suporte/Ajuda</h4>
                    <a href="{{ url_for('main.relatar_bug_page') }}"
                        >Central de Ajuda</a
                    >
                    <a href="#" onclick="abrirModalTermos(); return false;"
                        >Termos de Uso</a
                    >
                </div>

                <div class="rodape-coluna">
                    <h4>Contatos</h4>
                    <a>üìßcontato@valefeira.com.br</a>
                    <a>üìßsuportevaleefeira@gmail.com</a>
                    <a href="#">üì± (38) 3333-4444</a>
                    <p>üìç Vale do Jequitinhonha, MG</p>
                </div>
            </div>

            <div class="rodape-final">
                &copy; 2026 Vale&Feira. Todos os direitos reservados.
            </div>
        </footer>

        <a
            href="{{ url_for('main.relatar_bug_page') }}"
            class="botao-flutuante-bug"
            title="Relatar um problema"
        >
            ü™≤ Relatar Erro / Ajuda
        </a>

        <div id="modalTermos" class="modal-termos">
            <div class="modal-conteudo">
                <span class="botao-fechar-modal" onclick="fecharModalTermos()"
                    >&times;</span
                >

                <div class="modal-corpo">
                    <h3>Termos e Condi√ß√µes de Uso</h3>

                    <h4>1. Objeto e Defini√ß√£o</h4>
                    <p>
                        A plataforma Vale & Feira √© um ambiente digital
                        destinado √† divulga√ß√£o, promo√ß√£o e facilita√ß√£o da
                        comercializa√ß√£o de produtos cultivados e produzidos no
                        Vale do Jequitinhonha. O site atua como uma "feira
                        virtual", conectando produtores locais (agricultores
                        familiares e artes√£os) a potenciais compradores.
                    </p>

                    <h4>2. Natureza do Servi√ßo</h4>
                    <p>
                        O Vale & Feira n√£o realiza a venda direta nem processa
                        pagamentos (nesta vers√£o MVP). A plataforma facilita o
                        contato via WhatsApp ou e-mail.
                    </p>

                    <div class="modal-acoes">
                        <button
                            class="botao-fechar-termos"
                            onclick="fecharModalTermos()"
                        >
                            Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function abrirModalTermos() {
                document.getElementById("modalTermos").style.display = "flex";
            }

            function fecharModalTermos() {
                document.getElementById("modalTermos").style.display = "none";
            }

            window.onclick = function (event) {
                if (event.target == document.getElementById("modalTermos")) {
                    fecharModalTermos();
                }
            };
        </script>
    </body>
</html>
